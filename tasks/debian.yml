- name: update repositories cache and install latest openswan, but don't start it
  apt:
    name: openswan
    update_cache: yes
  environment:
    RUNLEVEL: 1

- name: install lsof utility
  apt:
    name: lsof

- name: kernel - disable ipv4 rx/tx of icmp redirects; enable fwd
  blockinfile:
    path: /etc/sysctl.conf
    block:
      {{ item.param }} = {{ item.val }}
    marker: "# {mark} ANSIBLE MANAGED BLOCK {{ item.name }}"
    with_items:
    - { parameter: net.ipv4.ip_forward, val: 1 }
    - { parameter: net.ipv4.conf.all.accept_redirects, val: 0 }
    - { parameter: net.ipv4.conf.all.send_redirects, val: 0 }
  notify:
    - schedule reload of sysctl kernel parameters
